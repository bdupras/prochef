<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Chef : Launch Cloud Instances with Knife</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Chef : Launch Cloud Instances with Knife
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Aug 03, 2012 by <font color="#0050B2">jessica</font>.
				    </div>

				    <table class="sectionMacro" border="0" cellpadding="5" cellspacing="0" width="100%"><tbody><tr>
<td class="confluenceTd" valign="top" width="3%"></td>
<td class="confluenceTd" valign="top">
<h1><a name="LaunchCloudInstanceswithKnife-Overview"></a>Overview</h1>
<p><span class="image-wrap" style="float: left"><a class="confluence-thumbnail-link 300x300" href='http://wiki.opscode.com/download../attachments/7274548/cloud-300x300.jpg'><img src="../attachments/thumbnails/7274548/14057498" hspace="24" vspace="6" style="border: 0px solid black"/></a></span></p>
<h5><a name="LaunchCloudInstanceswithKnife-"></a><font color="#f7681a">This page describes how to launch API-driven &quot;Cloud&quot; servers with <a href="Knife.html" title="Knife">Knife</a> and automatically run Chef on them.</font> </h5>

<p>This page covers the general use of the available cloud plugins.  Reference documentation for the individual plugins is maintained in the README of the plugin's code repository, linked below where available. <b>Currently supported services (version 0.10.0 with plugins):</b></p>

<p> <b><a href="https://github.com/opscode/knife-ec2/blob/master/README.rdoc">Amazon EC2</a></b><br/>
 <b><a href="https://github.com/opscode/knife-rackspace/blob/master/README.rdoc">Rackspace Cloud</a></b><br/>
 <b><a href="https://github.com/opscode/knife-openstack/blob/master/README.md">Openstack</a></b><br/>
 <b><a href="https://github.com/opscode/knife-bluebox/blob/master/README.rdoc">Bluebox</a></b><br/>
 <b><a href="https://github.com/opscode/knife-terremark">Terremark vCloud</a></b><br/>
 <b><a href="https://github.com/opscode/knife-eucalyptus/blob/master/README.rdoc">Eucalyptus</a></b><br/>
 <b><a href="https://github.com/opscode/knife-linode/blob/master/README.rdoc">Linode</a></b></p>

<p>These are supported via sub-commands in knife that use the Ruby library <a href="http://rubygems.org/gems/fog">fog</a>. During the &quot;bootstrap&quot; process that runs Chef, knife will SSH to the systems, and uses the <a href="http://rubygems.org/gems/net-ssh-multi">net-ssh-multi</a> library. Finally, knife uses colorized output via highline. </p>

<h1><a name="LaunchCloudInstanceswithKnife-InstallDependencies"></a>Install Dependencies</h1>

<p>You will need to install the fog, net-ssh-multi and highline gems / libraries on your local management workstation where you use knife.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">sudo gem install net-ssh net-ssh-multi fog highline --no-rdoc --no-ri --verbose</pre>
		</div>
</div></div>

<p>On Ubuntu you will also need to install some additional apt packages in order to compile the nokogiri gem (a fog dependency):</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: shell; gutter: false"># ruby developer packages
sudo apt-get install ruby1.8-dev ruby1.8 ri1.8 rdoc1.8 irb1.8
sudo apt-get install libreadline-ruby1.8 libruby1.8 libopenssl-ruby

# nokogiri requirements
sudo apt-get install libxslt-dev libxml2-dev</pre>
		</div>
</div></div>
<p>Once complete, you'd move on to continuing to setup knife with your "cloud" credentials.</p>

<h1><a name="LaunchCloudInstanceswithKnife-CloudCredentials"></a>Cloud Credentials</h1>

<p><font color="#f7681a">Add the Cloud Credentials to your knife.rb.</font> They are specifically named for each of the service providers Knife supports as keys under the <tt>knife</tt> configuration option.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: ruby; gutter: false"># EC2:
knife[:aws_access_key_id]     = "Your AWS Access Key"
knife[:aws_secret_access_key] = "Your AWS Secret Access Key"

# Rackspace:
knife[:rackspace_api_key]      = "Your Rackspace API Key"
knife[:rackspace_api_username] = "Your Rackspace API username"

# Terremark
knife[:terremark_password] = "Your Terremark Password"
knife[:terremark_username] = "Your Terremark Username"
knife[:terremark_service]  = "Your Terremark Service name"

# Eucalyptus
knife[:euca_access_key_id]     = "Your Eucalyptus Access Key"
knife[:euca_secret_access_key] = "Your Eucalyptus Secret Access Key"
knife[:euca_api_endpoint]      = "http://ecc.eucalyptus.com:8773/services/Eucalyptus"</pre>
		</div>
</div></div>

<p>Add the appropriate lines for your preferred Cloud Computing service to your <tt>knife.rb</tt>.</p>

<p><br class="atl-forced-newline" /></p>
<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Chef 0.10: Command examples on this page</b><br /><br class="atl-forced-newline" />
The command examples on this page now use Chef 0.10's knife plugin syntax.  See the <b><a href="http://www.opscode.com/blog/2011/04/22/chef-0-10-preview-knife-plugins-and-ui/">Opscode Blog Post</a></b> for an overview.</td></tr></table></div></td>
<td class="confluenceTd" valign="top" width="2%"></td>
<td class="confluenceTd" valign="top" width="29%">
<p><br class="atl-forced-newline" /></p>
<div class="panel" style="background-color: #d7d4c3;border-width: 1px;"><div class="panelContent" style="background-color: #d7d4c3;">
<div>
<ul>
    <li><a href='#LaunchCloudInstanceswithKnife-Overview'>Overview</a></li>
    <li><a href='#LaunchCloudInstanceswithKnife-InstallDependencies'>Install Dependencies</a></li>
    <li><a href='#LaunchCloudInstanceswithKnife-CloudCredentials'>Cloud Credentials</a></li>
    <li><a href='#LaunchCloudInstanceswithKnife-CloudSubcommands'>Cloud Sub-commands</a></li>
    <li><a href='#LaunchCloudInstanceswithKnife-Creatingtheserverwiththeknifeplugin'>Creating the server with the knife plugin</a></li>
    <li><a href='#LaunchCloudInstanceswithKnife-InstanceBootstrap'>Instance Bootstrap</a></li>
<ul>
    <li><a href='#LaunchCloudInstanceswithKnife-IfTheRunDoesNotComplete'>If The Run Does Not Complete</a></li>
    <li><a href='#LaunchCloudInstanceswithKnife-BootstrapSubcommand'>Bootstrap Subcommand</a></li>
</ul>
    <li><a href='#LaunchCloudInstanceswithKnife-SSHConfiguration'>SSH Configuration</a></li>
<ul>
    <li><a href='#LaunchCloudInstanceswithKnife-IdentityFile'>Identity File</a></li>
    <li><a href='#LaunchCloudInstanceswithKnife-SSHKeyID'>SSH Key ID</a></li>
</ul>
    <li><a href='#LaunchCloudInstanceswithKnife-ConfigurationOptions'>Configuration Options</a></li>
    <li><a href='#LaunchCloudInstanceswithKnife-ConnectingtoyourcloudfromitsexternalFQDN'>Connecting to your cloud from its external FQDN</a></li>
    <li><a href='#LaunchCloudInstanceswithKnife-Deletingaserver'>Deleting a server</a></li>
</ul></div>
</div></div>
<p><br class="atl-forced-newline" /></p>
<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Desire more EC2 specific information?</b><br /><br class="atl-forced-newline" />
In addition to the use of the knife-ec2 detailed here - there is also an <b><a href="EC2 Bootstrap Fast Start Guide.html" title="EC2 Bootstrap Fast Start Guide">EC2 Bootstrap Fast Start Guide</a></b> aimed at getting you up and running on EC2 as quick as possible, and an <b><a href="AMI List for Developers.html" title="AMI List for Developers">AMI List for Developers</a></b> which can be useful for cookbook testing.</td></tr></table></div>
<p><br class="atl-forced-newline" /></p>
<div class="panel" style="border-color: #f7681a;border-width: 2px;"><div class="panelContent">
<div class="" align="center"><h4><a name="LaunchCloudInstanceswithKnife-"></a><font color="#f7681a">Tutorials from the Community</font></h4></div>

<hr />

<ul>
	<li><h6><a name="LaunchCloudInstanceswithKnife-"></a><font color="navy"> Be Agile with EC2 and Knife </font></h6></li>
</ul>


<p>Our friends at <a href="http://www.agileweboperations.com/">Agile Web Operations</a> provided this <b><a href="http://www.agileweboperations.com/amazon-ec2-instances-with-opscode-chef-using-knife">Blog Post on Amazon EC2 Instances Using Knife</a></b>.  Check it out!
<br class="atl-forced-newline" /></p>
<ul>
	<li><h6><a name="LaunchCloudInstanceswithKnife-"></a><font color="navy"> Chef and AWS Auto-Scaling </font></h6></li>
</ul>


<p>Community member <a href="http://community.opscode.com/users/ejsarge">Edward Sargisson</a> has a nice blog post up on <b><a href="http://www.trailhunger.com/blog/technical/2011/05/28/keeping-an-amazon-elastic-compute-cloud-ec2-instance-up-with-chef-and-auto-scaling/">Keeping an Amazon Elastic Compute Cloud (EC2) Instance Up with Chef and Auto Scaling</a>.</b>
<br class="atl-forced-newline" /></p>
<ul>
	<li><h6><a name="LaunchCloudInstanceswithKnife-"></a><font color="navy">Chef &amp; Eucalyptus</font></h6></li>
</ul>


<p>Opscode joins Brady Murray from <a href="http://www.eucalyptus.com/">Eucalyptus Systems</a> to conduct a Webinar on how to <b><a href="http://blip.tv/opscode/webinar-build-automated-private-cloud-infrastructure-with-chef-eucalyptus-5410876">Build Automated Private Cloud Infrastructure With Chef &amp; Eucalyptus</a></b>.  Check it out!
<br class="atl-forced-newline" /></p>
<ul>
	<li><h6><a name="LaunchCloudInstanceswithKnife-"></a><font color="navy">Chef Managed EC2 Fedora Instances</font></h6></li>
</ul>


<p>Community member <a href="http://wiki.opscode.com/display/~cixelsyd">Steven Craig</a> has a most excellent blog post providing an all-in-one to get you from zero to N-1 fully chef-managed <b><a href="http://www.ikickass.com/shortthoughts/provisionchef-managedfedoraamazonec2virtualmachineinstances">Fedora Amazon EC2 instances backed with custom EBS root devices in less than 60 minutes!</a></b>. Worthwhile!</p>
</div></div>
<p><br class="atl-forced-newline" /></p>

<div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Knife Plugins</b><br /><br class="atl-forced-newline" />
See <b><a href="Knife Plugins.html" title="Knife Plugins">Knife Plugins</a></b> for how to conveniently keep a set of knife plugins that you reuse across projects in your home directory, share plugins with your team by including them in your cookbook repo, and share plugins with the whole Chef community by distributing them as Ruby gems.</td></tr></table></div>
</td>
<td class="confluenceTd" valign="top" width="5%"></td></tr></tbody></table>
<table class="sectionMacro" border="0" cellpadding="5" cellspacing="0" width="100%"><tbody><tr>
<td class="confluenceTd" valign="top" width="3%"></td>
<td class="confluenceTd" valign="top">
<h1><a name="LaunchCloudInstanceswithKnife-CloudSubcommands"></a>Cloud Sub-commands</h1>

<p><span class="image-wrap" style="float: right"><img src="../attachments/7274548/23658501.jpg" hspace="6" vspace="6" style="border: 0px solid black"/></span></p>

<p><font color="#f7681a">Cloud sub-commands for knife are available as <a href="Knife Plugins.html" title="Knife Plugins">Knife Plugins</a>.</font> The following plugins are provided by Opscode as RubyGems. Install the desired plugin to make the sub-commands described below available.</p>

<ul>
	<li>knife-ec2</li>
	<li>knife-rackspace</li>
	<li>knife-openstack</li>
	<li>knife-bluebox</li>
	<li>knife-terremark</li>
	<li>knife-eucalyptus</li>
</ul>


<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>Installing the knife-ec2 plugin</b></div><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">% sudo gem install knife-ec2 --no-rdoc --no-ri --verbose</pre>
		</div>
</div></div>

<p>If you are using <a href="Omnibus Information.html" title="Omnibus Information">Omnibus</a> on your workstation you can install the plugin to the embedded version of gems instead:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>Installing the knife-ec2 plugin on Omnibus</b></div><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">% sudo /opt/chef/embedded/bin/gem install knife-ec2 --no-rdoc --no-ri --verbose</pre>
		</div>
</div></div>

<p>On some platforms this will be in the /opt/opscode/embedded directory instead. If you get an error stating that the knife-ec2 gem isn't found after installing it you are most likely using Omnibus chef and need to use the embedded gem install command above. You can also check which you're using with this command:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">% ls -l $(which knife)
lrwxrwxrwx 1 root root 19 Aug 1 17:19 /usr/bin/knife -&gt; /opt/chef/bin/knife</pre>
		</div>
</div></div>
<p>If you are using Omnibus Chef you will see a symlink to /opt/chef or /opt/opscode like in the example above.</p>

<p>The sub-commands for cloud management in knife follow the pattern:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife SERVICE server ACTION
# server creation:
knife SERVICE server create -r [RUN LIST...] (options)</pre>
		</div>
</div></div>

<p>Where service is <tt>ec2</tt>, <tt>rackspace</tt>, <tt>openstack</tt>, <tt>bluebox</tt>, <tt>openstack</tt>, or <tt>terremark</tt>, <tt>euca</tt> each of the services has a <tt>server create</tt> sub-command that uses their API to launch a new instance of the specified flavor or image with a run list. </p>

<p>Enclose the run list items in quotes, as the brackets for <tt>role[thing]</tt> or <tt>recipe[thing]</tt> may be interpreted by your login shell. Multiple items can be specified as a comma separated list.  </p>

<h1><a name="LaunchCloudInstanceswithKnife-Creatingtheserverwiththeknifeplugin"></a>Creating the server with the knife plugin </h1>

<p>Once the plugin is installed, you can create the server using the <tt>knife SERVICE server create</tt> command:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>Launch a new EC2 instance with the webserver role</b></div><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife ec2 server create -r "role[webserver]" -I ami-2d4aa444 --flavor m1.small -G www,default -x ubuntu -N server01
# multiple items in the run list:
knife ec2 server create -r "role[base],role[webserver]" -I ami-2d4aa444 -G www,default -x ubuntu --node-name server01</pre>
		</div>
</div></div>
<p><em>EC2 Note</em>: The AMI used above is just an example.  You should use the most current AMI's for your OS.  For instance: the Ubuntu AMIs are found at their site, in the <a href="http://uec-images.ubuntu.com/">version subdirectories under "releases"</a>.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>To launch a new Rackspace instance with the webserver role</b></div><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife rackspace server create -r 'role[webserver]' --server-name server01 --node-name server01 --image 49 --flavor 2
knife rackspace server create -r 'role[base],role[webserver]' --server-name server01 -N server01 --image 49 --flavor 2</pre>
		</div>
</div></div>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Node name</b><br />If no node name is specified with the -N or --node-name flags, knife will automatically generate a node name based on information supplied by the cloud provider, such as a numeric server id. These machine generated names are generally less descriptive than is usually desirable.</td></tr></table></div>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Syntax for Run List in Chef 0.10</b><br />In the knife plugins used for these cloud computing commands with Chef 0.10, <em>the run list must be specified with the -r option</em>. Earlier versions of Chef did not use -r.</td></tr></table></div>

<p>See the <a href="Knife.html" title="Knife">Knife documentation</a> for more information on the syntax for the subcommands and further options.</p>

<h1><a name="LaunchCloudInstanceswithKnife-InstanceBootstrap"></a>Instance Bootstrap</h1>

<p><font color="#f7681a">The server creation sub-command <tt>bootstrap</tt> the instance.</font>  When the instance is launched, knife determines whether it is available, and once it is, ssh's to the instance using the specified username (or your local user if none specified) and does the following:</p>

<ol>
	<li>Installs Ruby and packages to support installing RubyGems with native extensions.</li>
	<li>Installs RubyGems from source.</li>
	<li>Installs Chef from RubyGems.</li>
	<li>Creates the /etc/chef directory.</li>
	<li>Writes your validation certificate to /etc/chef/validation.pem.</li>
	<li>Writes an <a href="Chef Configuration Settings.html" title="Chef Configuration Settings">/etc/chef/client.rb</a> config file.</li>
	<li>Writes a JSON file, /etc/chef/first-boot.json with the roles and recipes specified as the run list.</li>
	<li>Executes chef-client with the first-boot.json, connecting to the server in the client.rb.</li>
</ol>


<p>Once the Chef run is complete, the new instance will be registered with the Chef Server and be saved as a node object. This process does not set up the Chef Client service, you'll need to add a recipe in the run list that does this.</p>

<p>You can see the config file that will be copied by creating one with:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife configure client client-config</pre>
		</div>
</div></div>

<p>The client.rb and validation.pem will be copied to the specified directory, in this case <tt>client-config</tt>.</p>

<h3><a name="LaunchCloudInstanceswithKnife-IfTheRunDoesNotComplete"></a>If The Run Does Not Complete</h3>
<p>The run list for the first run of a newly provisioned node is passed in by knife as a file with the special command line:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">chef-client -j /etc/chef/first-boot.json</pre>
		</div>
</div></div>
<p>At the end of the first run, the node object is saved with this list, shows up on the console and knife commands, and is used on subsequent chef-client runs.  If the run does not complete, (the instance is created but the installs are not completed), then the node with the run list applied to it is never saved.  </p>

<p>Run the above command if this occurs.  <font color="#f7681a">The normal state is for the first chef-client run to complete - an incomplete run is the sort of thing that will happen while debugging changes and new recipes.</font>  A typical cause is an unmet dependency in cookbooks.  Review the metadata.rb files of the cookbooks in your base role, or any other roles being established in the initial run for any dependencies.</p>

<h3><a name="LaunchCloudInstanceswithKnife-BootstrapSubcommand"></a>Bootstrap Subcommand</h3>

<p>Currently, the bootstrap subcommand is used on EC2 and Rackspace instances. This isn't cloud-provider specific, and can be used on any kind of system, like a bare metal server or a VMware machine.</p>

<p>The bootstrap sub-command is not used by the <tt>terremark</tt> or <tt>openstack</tt> or <tt>euca</tt> server creation yet:</p>
<ul>
	<li><a href="http://tickets.opscode.com/browse/CHEF-1731">CHEF-1731</a> is an open ticket for Terremark to have this functionality</li>
	<li>Use the <a href="Deploying OpenStack with Chef.html" title="Deploying OpenStack with Chef">Deploying OpenStack with Chef</a> Guide for Openstack</li>
</ul>


<h1><a name="LaunchCloudInstanceswithKnife-SSHConfiguration"></a>SSH Configuration</h1>

<p>Some providers will require you to authenticate with them through an SSH Key. There are two parts you will need to setup, after creating the key with the hosting provider.</p>

<h3><a name="LaunchCloudInstanceswithKnife-IdentityFile"></a>Identity File</h3>

<p><font color="#f7681a">The bootstrap process uses SSH, so you'll need to configure your system to SSH in a particular way.</font> The easiest way to make sure that SSH uses your Cloud service's SSH key is to add it to your SSH key agent. For example, if you have saved the private key for EC2 to <tt>~/.ssh/ec2_ssh_key</tt>:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">$ ssh-agent
SSH_AUTH_SOCK=/tmp/ssh-RHHBa22270/agent.22270; export SSH_AUTH_SOCK;
SSH_AGENT_PID=22271; export SSH_AGENT_PID;
echo Agent pid 22271;

$ ssh-add ~/.ssh/ec2_ssh_key</pre>
		</div>
</div></div>

<p>On Mac OS X Snow Leopard, ssh-agent is already running by default when you use Terminal.</p>

<p>You also need to specify the current user to SSH as:</p>

<ul>
	<li>On Canonical's Ubuntu AMIs, this is <tt>ubuntu</tt>.</li>
	<li>If you're using an image that uses a different user, specify it with <tt>&#45;x</tt> in the server create command.</li>
</ul>


<p>Once this is added, you will not need to supply an identity_file option when using the knife command. You will still need to provide the AWS SSH Key ID. </p>

<h3><a name="LaunchCloudInstanceswithKnife-SSHKeyID"></a>SSH Key ID</h3>

<p>You can supply the key id with <tt>-S</tt> or by adding this line to your knife.rb file.</p>

<p>For EC2:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife[:aws_ssh_key_id] = "KEY_PAIR_NAME"</pre>
		</div>
</div></div>

<p>For Openstack: </p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife[:openstack_ssh_key_id] = "KEY_PAIR_NAME"</pre>
		</div>
</div></div>

<p>For Eucalyptus:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife[:euca_ssh_key_id] = "KEY_PAIR_NAME"</pre>
		</div>
</div></div>

<p>The ID is the name of the key file from when you created it. For instance if your key was named KeyId.pem when you downloaded it, the KEY_PAIR_NAME will be "KeyId". </p>

<h1><a name="LaunchCloudInstanceswithKnife-ConfigurationOptions"></a>Configuration Options</h1>

<p>You can find the full list of configuration options for each plugin by reading the readme included:</p>

<p> <b><a href="https://github.com/opscode/knife-ec2/blob/master/README.rdoc">Amazon EC2</a></b><br/>
 <b><a href="https://github.com/opscode/knife-rackspace/blob/master/README.rdoc">Rackspace Cloud</a></b><br/>
 <b><a href="https://github.com/opscode/knife-openstack/blob/master/README.rdoc">Openstack</a></b><br/>
 <b><a href="https://github.com/opscode/knife-bluebox/blob/master/README.rdoc">Bluebox</a></b><br/>
 <b><a href="https://github.com/opscode/knife-terremark">Terremark vCloud</a></b><br/>
 <b><a href="https://github.com/opscode/knife-eucalyptus/blob/master/README.rdoc">Eucalyptus</a></b></p>

<p>Most of them support setting the flavor, image, distro, template_file through the knife.rb and some also support setting SSH options or the region.</p>

<p>For a list of all of the switches available with the plugin, you can use the command <tt>knife SERVICE server create --help</tt>.</p>

<h1><a name="LaunchCloudInstanceswithKnife-ConnectingtoyourcloudfromitsexternalFQDN"></a>Connecting to your cloud from its external FQDN</h1>

<p><font color="#f7681a">By default, knife will use the internal FQDN to connect to nodes.</font> When connecting from outside of your cloud you may need to force this to use the external FQDN. You will want to avoid doing this unless necessary, as this will route all traffic out through the NAT infrustructure and could cause performance hits or additional usage charges.</p>

<p>If you're sure you want to do this, you can do it with the -a option, such as in this example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife ssh "role:webserver" "sudo chef-client" -a ec2.public_hostname</pre>
		</div>
</div></div>

<h1><a name="LaunchCloudInstanceswithKnife-Deletingaserver"></a>Deleting a server</h1>

<p>To delete a server once you are done using it, you will want to use this command:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife &lt;plugin name&gt; server delete &lt;instance id&gt;</pre>
		</div>
</div></div>
<p>The instance id can be located with the command '<tt>knife &lt;plugin name&gt; server list</tt>' or '<tt>knife status</tt>'. For example, you could delete a server using these commands if you were using the rackspace plugin:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">$ knife rackspace server list
   Instance ID    Public IP      Private IP     Flavor         Image          Name           State
   12345678       1.1.1.1   192.168.1.1  3              49             slice12345678  active
 
$ knife rackspace server delete 12345678
   Instance ID: 12345678
   Host ID: testexample
   Name: slice12345678
   Flavor: 1GB server
   Image: Ubuntu 10.04 LTS (lucid)
   Public DNS Name: 1-1-1-1.static.cloud-ips.com
   Public IP Address: 1.1.1.1
   Private IP Address: 192.168.1.1

   Do you really want to delete this server? (Y/N) Y
   WARNING: Deleted server 12345678 named slice12345678</pre>
		</div>
</div></div>
<p>Make sure that you also clean up the associated 'node' and 'client' objects from hosted chef:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife node delete 12345678
knife client delete 12345678</pre>
		</div>
</div></div>
<p><br class="atl-forced-newline" />
<br class="atl-forced-newline" />
<br class="atl-forced-newline" />
<br class="atl-forced-newline" /></p></td>
<td class="confluenceTd" valign="top" width="5%"></td></tr></tbody></table>
<table class="sectionMacro" border="0" cellpadding="5" cellspacing="0" width="100%"><tbody><tr>
<hr />
<td class="confluenceTd" valign="top" width="45%">

<p><a href="Knife Exec.html" title="Knife Exec"><span class="image-wrap" style="float: left"><img src="../attachments/7274548/21463147.png" hspace="4" style="border: 0px solid black"/></span> Knife Exec </a></p>
</td>
<td class="confluenceTd" valign="top" width="40%"></td>

<td class="confluenceTd" valign="top" width="15%">

<p><a href="Managing API Clients With Knife.html" title="Managing API Clients With Knife"><span class="image-wrap" style="float: right"><img src="../attachments/7274548/21463146.png" hspace="4" style="border: 0px solid black"/></span> Managing API Clients With Knife </a></p>

<p><br class="atl-forced-newline" />
<br class="atl-forced-newline" /></p></td></tr></tbody></table>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">
                                <h2>Attachments:</h2>
                            </a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="../attachments/7274548/14057498.jpg">cloud-300x300.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="../attachments/7274548/21463146.png">rightarrow.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="../attachments/7274548/21463147.png">leftarrow.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="../attachments/7274548/23658501.jpg">10366948-a-cloud-computing-technology-concept.jpg</a> (image/jpeg)
                                <br/>
                                                    </div>
				    
                                            <div class="tabletitle">
                            <a name="comments">
                                <h2>Comments:</h2>
                            </a>
                        </div>

                        <table border="0" width="100%">
                                                        <tr>
                                <td >
                                    <a name="comment-7897159"></a>
                                    <font class="smallfont"><p>When trying to create a new rackspace instance, I encountered the following error</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">ERROR: Please install net-ssh version 2.0.23 or higher, as lower versions cause issues.</pre>
		</div>
</div></div>

<p>It appears that there is a minor bug in /usr/lib/ruby/1.8/chef/knife/ssh.rb, at the top, it checks for net-ssh version &gt;= 2.0.23 but at the bottom, where it throws this error, it checks for </p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">unless (netssh_version::MAJOR == 2) &amp;&amp; (netssh_version::TINY &gt;= 23 || netssh_version::MINOR &gt;= 1)</pre>
		</div>
</div></div>

<p>I think it should be </p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">unless (netssh_version::MAJOR == 2) &amp;&amp; (netssh_version::TINY &gt;= 23 || netssh_version::MINOR &gt;= 0)</pre>
		</div>
</div></div>

<p>I am running ubuntu 10.04 and chef via 'deb <a href="http://apt.opscode.com/">http://apt.opscode.com/</a> lucid main' in /etc/apt/sources.list.d/opscode.list</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ajay@where.com at Aug 30, 2010 00:50
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-8257862"></a>
                                    <font class="smallfont"><p>I believe the EC setup should really be</p>


<p>knife ec2 server create "rolewebserver" -i ami-2d4aa444 -G default -x ubuntu -S us-east-01</p>

<p>-G default is the security group - make sure that you are using a group that allows access to all port you want (80 for HTTP for example)<br/>
-S us-east-01 is the ssh key. If non is specified it seems you will be unable to log into the new EC2 instance. You will need to set up this key for ssh_agent as explained above.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ewolff at Dec 17, 2010 12:30
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-8683573"></a>
                                    <font class="smallfont"><p>I've run into issues on some platforms where the knife command fails to launch an EC2 instance due to certificate validation issues. This is not a Chef or Knife problem, and it seems to happen from time to time. (<a href="https://github.com/geemus/excon/issues/issue/13">https://github.com/geemus/excon/issues/issue/13</a>)</p>

<p>The best workaround that I have found so far is to add the following to the bottom of .chef/knife.rb</p>

<p>  require 'excon' <br/>
  Excon.ssl_verify_peer = false</p>

<p>It's certainly not the ideal solution, but I spent several hours figuring that out, and it's better than not being able to bootstrap servers.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by cpope at Feb 01, 2011 21:17
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-8683674"></a>
                                    <font class="smallfont"><p>Apologies in advance if I'm posting this in the wrong place...</p>


<p><b>Question: Is ubuntu still the only OS supported by this process?</b></p>

<p>I tried launching an EC2 instance that was Fedora based, and things died out I think in or around trying to build the native Gem extensions...</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">...
/usr/bin/prettify_json.rb
Building native extensions.  This could take a while..

ERROR:  Error installing chef:
	ERROR: Failed to build gem native extension.

/usr/bin/ruby extconf.rb
can't find header files for ruby.


Gem files will remain installed in /usr/lib/ruby/gems/1.8/gems/json-1.4.6 for inspection.
Results logged to /usr/lib/ruby/gems/1.8/gems/json-1.4.6/ext/json/ext/generator/gem_make.out
bash: line 65: /usr/bin/chef-client: No such file or directory

...</pre>
		</div>
</div></div>

<p>I noticed the comment above saying that "The current implementation is opinionated and is focused on Ubuntu servers, but we are working to support other platforms and methods." but when I went to the ticket (<a href="http://tickets.opscode.com/browse/CHEF-1376">http://tickets.opscode.com/browse/CHEF-1376</a>) it said it was a dup of (<a href="http://tickets.opscode.com/browse/CHEF-1393">http://tickets.opscode.com/browse/CHEF-1393</a>) which is marked as closed... </p>

<p>So... any thoughts on what I'm doing wrong.</p>

</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by opscode-admin@korrio.com at Feb 16, 2011 19:31
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-20774970"></a>
                                    <font class="smallfont"><p>I'd like to be able to provision a cloud instance and have the chef-client daemonize as is possible with the knife bootstrap method. What's the best approach to this?</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by matt@williams-tech.net at Nov 15, 2011 01:40
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-20774973"></a>
                                    <font class="smallfont"><p>Matt,</p>

<p>Use Opscode's "chef-client" cookbook. It provides a service recipe that will set up chef-client to run as a daemon.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by jtimberman at Nov 15, 2011 17:06
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-20775004"></a>
                                    <font class="smallfont"><p>This worked well - thanks.</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by matt@williams-tech.net at Nov 15, 2011 22:24
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-24019973"></a>
                                    <font class="smallfont"><p>Hi,</p>

<p>Can I start a windows instance (Windows Server 2008) with 'knife ec2 server create' ?</p>

<p>Thank you,<br/>
Razvan</p></font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by razvant7 at May 14, 2012 07:07
                                    </div>
                                </td>
                            </tr>
                                                        <tr>
                                <td  style="border-top: 1px dashed #666666">
                                    <a name="comment-24773064"></a>
                                    <font class="smallfont"><p>Or can I run knife openstack server create for Windows Server 2008?</p>

<p>It does create an instance but not able to run chef commands on the node/client. Actually it tries to connect/login to the launched instance but with no success.</p>
</font>
                                    <div align="left" class="smallfont" style="color: #666666; width: 98%; margin-bottom: 10px;">
                                        <img src="images/icons/comment_16.gif" height="16" width="16" border="0" align="absmiddle"/>
                                        Posted by ranjank at Jul 06, 2012 11:32
                                    </div>
                                </td>
                            </tr>
                                                    </table>
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://wiki.opscode.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Aug 04, 2012 00:05</font></td>
		    </tr>
	    </table>
    </body>
</html>
