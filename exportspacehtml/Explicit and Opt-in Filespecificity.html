<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Chef : Explicit and Opt-in Filespecificity</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Chef : Explicit and Opt-in Filespecificity
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jun 15, 2011 by <font color="#0050B2">dan@kallistec.com</font>.
				    </div>

				    <h1><a name="ExplicitandOpt-inFilespecificity-Abstract"></a>Abstract</h1>
<p><a href="File Distribution.html#FileDistribution-FileSpecificity">File Specificity</a> is a feature of Chef where a Cookbook file or template is dynamically sourced based on the hostname and platform of the system under management. The current implementation of file specificity has the following disadvantages:</p>
<ul>
	<li><em>Users who do not need this feature are required to understand or at least be aware of it in order to create cookbooks:</em> The directory layouts for templates and cookbook files counterintuitively require the user to place files under a <tt>default/</tt> directory. Before learning about file specificity, users expect to be able to place cookbook files and templates in the root of the <tt>files/</tt> and <tt>templates/</tt> directories, respectively.</li>
	<li><em>There is no way for specificity to operate on any property other than hostname and platform:</em> Many users have homogenous (or reasonably homogenous) environments, but would have a use for specificity based on geography (datacenter A gets a different file), environment (production/qa/dev gets a different file) or another property.</li>
</ul>


<p>To resolve these deficiencies, file specificity should be <em>opt-in</em> and <em>explicit</em>. When no specificity is declared, files should be fetched from the root of <tt>files/</tt> or <tt>templates/</tt> as appropriate. When enabled, file specificity should support user-defined specificity rules on a per-resource basis.</p>

<h1><a name="ExplicitandOpt-inFilespecificity-CompatibilityConcerns"></a>Compatibility Concerns</h1>
<p>If implemented immediately with no deprecation period, this proposal would break almost every cookbook. Therefore, if implemented, it must be implemented in stages across several major releases of Chef, with backwards compatibility maintained for a reasonable amount of time and clear messaging to users about what is changing, when, and why. If possible, automated tooling should be provided to migrate cookbooks.</p>

<h1><a name="ExplicitandOpt-inFilespecificity-Implementation."></a>Implementation.</h1>
<h3><a name="ExplicitandOpt-inFilespecificity-SourceasArray"></a>Source as Array</h3>
<p>The fully explicit syntax would look like this:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">file "foo" do
  source "host-www.example.com/foo", "ubuntu-10.04/foo", "ubuntu/foo", "default/foo"
end</pre>
		</div>
</div></div>

<p>However, helper methods can be provided to make this less onerous:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">file "foo" do
  source platform_specific("foo")
end</pre>
		</div>
</div></div>

<h3><a name="ExplicitandOpt-inFilespecificity-ExplicitSpecificityOption"></a>Explicit Specificity Option</h3>
<p><b>TODO</b></p>

<p>Adds a specificity attribute, which takes a code block or a symbol...</p>

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://wiki.opscode.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Aug 04, 2012 00:07</font></td>
		    </tr>
	    </table>
    </body>
</html>
