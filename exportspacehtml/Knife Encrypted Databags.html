<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Chef : Knife Encrypted Databags</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Chef : Knife Encrypted Databags
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Dec 19, 2011 by <font color="#0050B2">tom@opscode.com</font>.
				    </div>

				    <p>This page serves as an excerpt to be included on other pages so we have <a href="http://en.wikipedia.org/wiki/Drydock">"DRY" docs</a>.</p>

<p>To add it to a page, use:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">{excerpt-include:Knife Encrypted Databags|nopanel=true}</pre>
		</div>
</div></div>



<h2><a name="KnifeEncryptedDatabags-Encrypteddatabagsandknife"></a>Encrypted data bags and knife</h2>

<p><font color="#f7681a">The encrypted data bag features of the <tt>knife data bag *</tt> subcommands are activated by specifying either a <tt>&#45;&#45;secret</tt> or <tt>--secret-file</tt> option.</font></p>

<ul>
	<li><tt>&#45;&#45;secret SECRET</tt> is used to specify the key used for encryption and decryption on the command line.</li>
	<li><tt>--secret-file FILE</tt> is used to specify the path to a file that contains the encryption/decryption key.</li>
</ul>


<h3><a name="KnifeEncryptedDatabags-Createanewencrypteddatabagitem"></a>Create a new encrypted data bag item</h3>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">openssl rand -base64 512 | tr -d '\r\n' &gt; /tmp/my_data_bag_key
knife data bag create --secret-file /tmp/my_data_bag_key passwords mysql
# Enter user and password credentials in the editor and save</pre>
		</div>
</div></div>

<p>Verify that the data bag has been created and encrypted</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife data bag show passwords mysql

## example output:
{
  "id": "mysql",
  "pass": "trywgFA6R70NO28PNhMpGhEvKBZuxouemnbnAUQsUyo=\n",
  "user": "e/p+8WJYVHY9fHcEgAAReg==\n"
}</pre>
		</div>
</div></div>

<h3><a name="KnifeEncryptedDatabags-Decryptanencrypteddatabagitem"></a>Decrypt an encrypted data bag item</h3>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife data bag show --secret-file /tmp/my_data_bag_key passwords mysql
## example output:
{
  "id": "mysql",
  "pass": "thesecret123",
  "user": "fred"
}</pre>
		</div>
</div></div>

<h3><a name="KnifeEncryptedDatabags-Otherknifeencrypteddatabagcommands"></a>Other knife encrypted data bag commands</h3>

<p>When given a <tt>&#45;&#45;secret</tt>  or <tt>--secret-file</tt> option,</p>

<ul>
	<li><tt>knife data bag from file</tt> will <b>encrypt</b> the data bag item contained in the specified JSON file;</li>
	<li><tt>knife data bag edit</tt> will <b>decrypt</b> an existing data bag item, allow you to edit it, and then encrypt it before saving it to Chef</li>
</ul>


				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://wiki.opscode.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Aug 04, 2012 00:07</font></td>
		    </tr>
	    </table>
    </body>
</html>
