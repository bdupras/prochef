<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Chef : OpenStack Bootstrap Fast Start Guide</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Chef : OpenStack Bootstrap Fast Start Guide
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Aug 03, 2012 by <font color="#0050B2">jessica</font>.
				    </div>

				    <table class="sectionMacro" border="0" cellpadding="5" cellspacing="0" width="100%"><tbody><tr>
<td class="confluenceTd" valign="top" width="3%"></td>
<td class="confluenceTd" valign="top">
<p><br class="atl-forced-newline" /></p>

<hr />
<p><span class="image-wrap" style="float: left"><img src="../attachments/24019295/24182870.png" hspace="12" vspace="4" style="border: 0px solid black"/></span></p>
<h5><a name="OpenStackBootstrapFastStartGuide-"></a><font color="#f7681a">This installation guide describes how to get up and running with Chef as quickly as possible, and will walk you through adding a client node on an OpenStack installation for your organization in Hosted Chef.</font></h5>

<hr />
<p><br class="atl-forced-newline" /></p>
<h6><a name="OpenStackBootstrapFastStartGuide-YoucanrunyourownChefServer%2CbutforthisguidewewilluseHostedChefastheChefServer%2Csoyoudon%27thavetosetoneup."></a>You can run your own Chef Server, but for this guide we will use Hosted Chef as the Chef Server, so you don't have to set one up.</h6>

<ul>
	<li><em>Clients</em> are able to run chef-client, but will be unable to download, edit, and upload recipes with knife.</li>
	<li><em>Management Workstations</em> are able to download, edit and upload recipes, and can be set up to work as clients as well so they can run chef-client.</li>
</ul>


<p>You can find directions for setting up workstations in the Fast Start Guides:</p>

<ul>
	<li><a href="Fast Start Guide.html" title="Fast Start Guide">Fast Start Guide for Linux and OS X</a></li>
	<li><a href="Fast Start Guide for Windows.html" title="Fast Start Guide for Windows">Fast Start Guide for Windows</a></li>
</ul>

</td>
<td class="confluenceTd" valign="top" width="40%">
<p><br class="atl-forced-newline" /></p>
<div class="panel" style="background-color: #d7d4c3;border-width: 1px;"><div class="panelContent" style="background-color: #d7d4c3;">
<p><span class="image-wrap" style="float: right"><img src="../attachments/24019295/24182866.jpg" hspace="16" vspace="4" style="border: 0px solid black"/></span></p>
<div>
<ul>
    <li><a href='#OpenStackBootstrapFastStartGuide-Assumptions'>Assumptions</a></li>
    <li><a href='#OpenStackBootstrapFastStartGuide-Steps'>Steps</a></li>
<ul>
    <li><a href='#OpenStackBootstrapFastStartGuide-Step1%3AInstalltheKnifeOpenStackPlugin'>Step 1: Install the Knife-OpenStack Plugin</a></li>
    <li><a href='#OpenStackBootstrapFastStartGuide-Step2%3AConfigureOpenStacksettingsandtheknife.rbfile'>Step 2: Configure OpenStack settings and the knife.rb file</a></li>
    <li><a href='#OpenStackBootstrapFastStartGuide-Step3%3ABootstraptheOpenStackInstance'>Step 3: Bootstrap the OpenStack Instance</a></li>
    <li><a href='#OpenStackBootstrapFastStartGuide-Step4%3AVerifytheinstallcompleted'>Step 4: Verify the install completed</a></li>
    <li><a href='#OpenStackBootstrapFastStartGuide-Step5%3AManagerecipesonthenewclientnode'>Step 5: Manage recipes on the new client node</a></li>
    <li><a href='#OpenStackBootstrapFastStartGuide-Step6%3ARunchefclientonthenewclientnode'>Step 6: Run chef-client on the new client node</a></li>
    <li><a href='#OpenStackBootstrapFastStartGuide-Step7%3ARunningchefclientasadaemon'>Step 7: Running chef-client as a daemon</a></li>
</ul>
    <li><a href='#OpenStackBootstrapFastStartGuide-Ifsomethinggoeswrong'>If something goes wrong</a></li>
    <li><a href='#OpenStackBootstrapFastStartGuide-WhatshouldIlookatnext%3F'>What should I look at next?</a></li>
</ul></div>
</div></div></td>
<td class="confluenceTd" valign="top" width="5%"></td></tr></tbody></table>
<table class="sectionMacro" border="0" cellpadding="5" cellspacing="0" width="100%"><tbody><tr>
<td class="confluenceTd" valign="top" width="3%"></td>
<td class="confluenceTd" valign="top">
<div class="panel" style="border-color: #f7681a;border-width: 2px;"><div class="panelContent">
<h1><a name="OpenStackBootstrapFastStartGuide-Assumptions"></a>Assumptions</h1>
</div></div>
<p><font color="#f7681a">In order to make this as quick as possible, we make some assumptions.</font> <em>If your system does not meet these assumptions, you will need to use the</em> <em><a href="Installation.html" title="Installation">Installation</a></em> <em>instructions that apply for the "flavor" of Chef you are installing.</em></p>

<h3><a name="OpenStackBootstrapFastStartGuide-YoualreadyhaveManagementWorkstationsetup"></a>You already have Management Workstation set up</h3>

<p><font color="#f7681a">In this guide we will be creating an OpenStack Instance and setting it up as a client. We assume you already have another node set up as your Management Workstation.</font></p>

<p>If you do not already have a workstation configured, you can find directions in the Fast Start Guides:</p>

<ul>
	<li><a href="Fast Start Guide.html" title="Fast Start Guide">Fast Start Guide for Linux and OS X</a></li>
	<li><a href="Fast Start Guide for Windows.html" title="Fast Start Guide for Windows">Fast Start Guide for Windows</a></li>
</ul>


<p>You'll want to follow one of these guides through at least step 4 and confirmed the knife commands worked properly. Once this is completed, you can return to this guide to set up another node as a client.</p>

<p><b>All of the commands in this guide will be run from the Management Workstation using knife commands to configure the client node remotely.</b></p>

<h3><a name="OpenStackBootstrapFastStartGuide-OpenStack"></a>OpenStack</h3>

<p>This guide assumes you are using OpenStack to set up instances. You should already have an account created with your OpenStack installation, and this guide assumes that you do not have the OpenStack instance configured yet. If you've already created the OpenStack instance, you can either delete it or use the regular <a href="Client Bootstrap Fast Start Guide.html" title="Client Bootstrap Fast Start Guide">Client Bootstrap Fast Start Guide</a> to configure it.</p>

<h3><a name="OpenStackBootstrapFastStartGuide-OperatingSystem"></a>Operating System</h3>

<p>Chef runs on many popular Unix and Linux platforms as well as Mac OS X and Windows.</p>

<ul>
	<li><b>Management Workstation OS:</b> We will describe how to set up using <b>Ubuntu 10.04</b> as the workstation by default, but these are general directions that will work on most workstations.</li>
</ul>


<ul>
	<li><b>Client OpenStack Instance OS:</b> There are directions included on setting up the OpenStack client as Ubuntu, Debian, RHEL, or CentOS but as long as you have an instance and a custom bootstrap file that works you can use any OS as the OpenStack client.</li>
</ul>


<p><br class="atl-forced-newline" /></p>
<div class="panel" style="border-color: #f7681a;border-width: 2px;"><div class="panelContent">
<h1><a name="OpenStackBootstrapFastStartGuide-Steps"></a>Steps</h1>
</div></div>

<p><b><font color="#f7681a">We will complete the following steps from the Management Workstation:</font></b></p>

<p>1. <a href="#OpenStackBootstrapFastStartGuide-Step1%253AInstalltheKnifeOpenStackPlugin">Install the Knife-OpenStack Plugin</a><br/>
2. <a href="#OpenStackBootstrapFastStartGuide-Step2%253AConfigureOpenStacksettingsandtheknifer...">Configure OpenStack settings and the knife.rb file</a><br/>
3. <a href="#OpenStackBootstrapFastStartGuide-Step3%253ABootstraptheOpenStackInstance">Bootstrap the OpenStack Instance</a><br/>
4. <a href="#OpenStackBootstrapFastStartGuide-Step4%253AVerifytheinstallcompleted">Verify the install completed</a><br/>
5. <a href="#OpenStackBootstrapFastStartGuide-Step5%253AManagerecipesonthenewclientnode">Manage recipes on the new client node</a><br/>
6. <a href="#OpenStackBootstrapFastStartGuide-Step6%253ARunchefclientonthenewclientnode">Run chef-client on the new client node remotely</a><br/>
7. <a href="#OpenStackBootstrapFastStartGuide-Step7%253ARunningchefclientasadaemon">Running chef-client as a daemon</a></p>

<p>When you are done with this guide you will have a workstation set up to work with OpenStack. You will also have a node on OpenStack added as a client to the Hosted Chef organization, and the getting-started recipe will have been run on it. It will also explain the basics of how you can manage this new client node remotely from your workstation.</p>

<p>For more in-depth information, please review the <a href="Launch Cloud Instances with Knife.html" title="Launch Cloud Instances with Knife">Launch Cloud Instances with Knife</a> page.</p>

<h2><a name="OpenStackBootstrapFastStartGuide-Step1%3AInstalltheKnifeOpenStackPlugin"></a>Step 1: Install the Knife-OpenStack Plugin</h2>

<p>If you have already installed and configured the knife-openstack plugin then you can skip to Step 3. <font color="#f7681a"> All of the steps in this guide are done from the management workstation you've already configured.</font></p>

<h3><a name="OpenStackBootstrapFastStartGuide-Installdependencies"></a>Install dependencies</h3>

<p>First you will need to install the dependencies needed for the knife-openstack plugin on your Ubuntu management workstation where you use knife. Unfortunately we still need to build rubygems:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">sudo apt-get update
sudo apt-get install ruby1.8-dev ruby1.8 ri1.8 rdoc1.8 irb1.8
sudo apt-get install libreadline-ruby1.8 libruby1.8 libopenssl-ruby
sudo apt-get install libxslt-dev libxml2-dev
sudo apt-get install git-core
cd /tmp
wget http://production.cf.rubygems.org/rubygems/rubygems-1.8.10.tgz
tar zxf rubygems-1.8.10.tgz
cd rubygems-1.8.10
sudo ruby1.8 setup.rb --no-format-executable</pre>
		</div>
</div></div>

<p>More information on why these are needed can be found on the <a href="Launch Cloud Instances with Knife.html" title="Launch Cloud Instances with Knife">Launch Cloud Instances with Knife</a> page.</p>

<h3><a name="OpenStackBootstrapFastStartGuide-Installtheplugin"></a>Install the plugin</h3>

<p>The patches to Fog, the Ruby cloud services library that knife-openstack utilizes to talk to OpenStack APIs, have not all made it upstream yet. Unfortunately this means that you will need to build fog and the knife-openstack plugin from source until they are available through RubyGems. Note that this plugin only works with Chef 0.10 and later.</p>

<p>First let's build and install a developer version of Fog.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">cd /tmp
git clone git://github.com/mattray/fog.git
cd fog
sudo gem build fog.gemspec
sudo gem install fog-1.3.1.gem</pre>
		</div>
</div></div>

<p>Next we'll build and install the latest version of the knife-openstack plugin.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">cd /tmp
git clone -b 0.6.0 git://github.com/mattray/knife-openstack.git
cd knife-openstack
sudo gem build knife-openstack.gemspec
sudo gem install knife-openstack-0.6.0.gem</pre>
		</div>
</div></div>

<p>If you are using <a href="Omnibus Information.html" title="Omnibus Information">Omnibus</a> on your workstation you will want to install these plugins to the embedded version of gems instead:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">sudo /opt/chef/embedded/bin/gem install fog-1.3.1.gem
sudo /opt/chef/embedded/bin/gem install knife-openstack-0.6.0.gem</pre>
		</div>
</div></div>

<p>On some platforms this will be in the /opt/opscode/embedded directory. If you get an error stating that the gem isn't found after installing it you are most likely using Omnibus chef and need to use the embedded gem install command above. You can also check which you're using with this command:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">$ ls -l $(which knife)
lrwxrwxrwx 1 root root 19 Aug 1 17:19 /usr/bin/knife -&gt; /opt/chef/bin/knife</pre>
		</div>
</div></div>
<p>If you are using Omnibus Chef you will see a symlink to /opt/chef or /opt/opscode like in this example.</p>

<h2><a name="OpenStackBootstrapFastStartGuide-Step2%3AConfigureOpenStacksettingsandtheknife.rbfile"></a>Step 2: Configure OpenStack settings and the knife.rb file</h2>

<p><font color="#f7681a">To authenticate with OpenStack, you'll need to use the username and password for your OpenStack account on your local workstation.</font><br/>
<span class="image-wrap" style=""><img src="../attachments/24019295/24182867.png" style="border: 0px solid black"/></span></p>

<h3><a name="OpenStackBootstrapFastStartGuide-ConfigureyourOpenStackSecurityGroup"></a>Configure your OpenStack Security Group</h3>

<p>You will need to set up SSH access to your OpenStack instances from external IPs, so knife will be able to reach them. You can do this by following these steps:</p>

<ol>
	<li>Log into the OpenStack Dashboard and select "Security Groups" on the left side of the screen</li>
	<li>Select the 'default' group. (Selecting security groups with <tt>knife openstack server create</tt> is currently unsupported).</li>
	<li>Click on the "Add a rule" tab</li>
	<li>Choose "tcp" for the 'ip protocol', add port "22" to the 'From port' and the 'To port' and enter "0.0.0.0/0" for the 'Cidr' to accept all traffic, then click on "Add Rule":<br/>
<span class="image-wrap" style=""><img src="../attachments/24019295/24182869.png" style="border: 0px solid black"/></span></li>
</ol>


<h3><a name="OpenStackBootstrapFastStartGuide-CreateyourSSHkeypairforOpenStackandsaveyouridentityfileonthelocalworkstation"></a>Create your SSH key pair for OpenStack and save your identity file on the local workstation</h3>

<ol>
	<li>Log into the OpenStack Dashboard and select "Keypairs" on the left side of the screen</li>
	<li>Select the "Add New Keypair" button</li>
	<li>Enter a name for your key pair and create it, this will download a .pem file to your local machine</li>
	<li>Save the key pair to <tt>~/.ssh/</tt> and remember the name of it</li>
	<li>make sure ssh-agent is running. To start it:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">exec ssh-agent /usr/bin/bash</pre>
		</div>
</div></div>
<p>If you do not use exec, you will get the following error message :<br/>
Could not open a connection to your authentication agent</p></li>
	<li>Now you can add this key pair to ssh with this command, substituting KEY_PAIR_NAME for the name of your key pair:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">ssh-add ~/.ssh/KEY_PAIR_NAME.pem</pre>
		</div>
</div></div>
<p>Note: This step is optional, if you skip it you'll need to remember to add the path to the identity file to your <tt>knife openstack server create</tt> command later with <tt>-i</tt>.<br/>
<span class="image-wrap" style=""><img src="../attachments/24019295/24182868.png" style="border: 0px solid black"/></span></p></li>
</ol>


<h3><a name="OpenStackBootstrapFastStartGuide-Configureknife.rbwithyourOpenStackCloudCredentials"></a>Configure knife.rb with your OpenStack Cloud Credentials</h3>

<p>Add your OpenStack Cloud Credentials to the bottom of your knife.rb:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife[:openstack_username] = "Your OpenStack Dashboard username"
knife[:openstack_password] = "Your OpenStack Dashboard password"
knife[:openstack_auth_url] = "http://cloud.mycompany.com:5000/v2.0/tokens"</pre>
		</div>
</div></div>

<h2><a name="OpenStackBootstrapFastStartGuide-Step3%3ABootstraptheOpenStackInstance"></a>Step 3: Bootstrap the OpenStack Instance</h2>

<p><font color="#f7681a">Before bootstrapping the instance you'll first need to choose a flavor and an image to use.</font> The available flavors server sizes can be found using</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife openstack flavor list</pre>
		</div>
</div></div>
<p>and the output will look similar to</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">ID  Name       Virtual CPUs  RAM       Disk  
1   m1.tiny    1             512 MB    0 GB  
2   m1.small   1             2048 MB   20 GB 
3   m1.medium  2             4096 MB   40 GB 
4   m1.large   4             8192 MB   80 GB 
5   m1.xlarge  8             16384 MB  160 GB</pre>
		</div>
</div></div>

<p>The available images can be found using</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife openstack image list</pre>
		</div>
</div></div>
<p>and the output will look similar to</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">ID  Name
52  CentOS-6.0
48  Fedora-16
59  RHEL-5.6
3   ubuntu-11.04
4   Windows</pre>
		</div>
</div></div>

<p>You will need to know the login name for the instance, as well as the bootstrap file you want to use.</p>

<div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Where are the bootstrap files located?</b><br />The knife bootstrap sub-command looks in three locations for the template to use:
<ul>
	<li><tt>bootstrap</tt> directory in the installed Chef Knife library (Location varies depending how you installed Chef).</li>
	<li><tt>bootstrap</tt> directory in the <tt>$PWD/.chef</tt>, e.g. in <tt>~/chef-repo/.chef</tt>.</li>
	<li><tt>bootstrap</tt> directory in the users <tt>$HOME/.chef</tt>.</li>
</ul>
</td></tr></table></div>

<p>You can then launch the instance with a command similar to this, substituting in your keypair, the node name, the flavor ID, the instance ID, the LOGIN_NAME and the BOOTSTRAP as needed:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife openstack server create -S KEYPAIR -N TESTNODE -f 1 -I 3 -x LOGIN_NAME -d BOOTSTRAP</pre>
		</div>
</div></div>
<p>and this would create an m1.tiny Ubuntu 11.04 instance.</p>

<p>Note that you do not need to use <tt>-d</tt> with Ubuntu as this will be used as the default. You could also use the <tt>-r</tt> flag to pass a run list to the node to use upon creation.</p>

<p>If you were creating a <b>CentOS</b> instance your command may look like this instead:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife openstack server create -S KEYPAIR -N TESTNODE -f 1 -I 52 -d centos5-gems</pre>
		</div>
</div></div>
<p>Note that you do not need to add <tt>-x root</tt> to this command as this will be used as the default.</p>

<h3><a name="OpenStackBootstrapFastStartGuide-Configurationoptions"></a>Configuration options</h3>

<p>You can see the full list of options that you can add to the knife.rb config file by reading the <a href="https://github.com/mattray/knife-openstack/blob/master/README.md">readme for the knife-openstack plugin</a>. You can see the full list of switches available at the command line by using this command:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife openstack server create --help</pre>
		</div>
</div></div>
<p>Here is a partial list, of the commands you are most likely to need:</p>

<p>    <tt>-S</tt> - The keypair to use with the instance<br/>
    <tt>-N</tt> - The Chef node name for your new node, currently required.<br/>
    <tt>-f</tt> - The ID of the flavor of server<br/>
    <tt>-I</tt> - The instance for the server<br/>
    <tt>-x</tt> - The ssh username, by default it will use "root"<br/>
    <tt>-d</tt> - Bootstrap a distro using a template, by default it will use ubuntu<br/>
    <tt>-r</tt> - Comma separated list of roles/recipes to apply. For example: <tt>knife openstack server create -r 'role[webserver],recipe[users]' ...</tt></p>

<h3><a name="OpenStackBootstrapFastStartGuide-ExpectedOutput"></a>Expected Output</h3>

<p>This is the output you can expect after entering this command. First you will see it create the instance:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">Instance ID: XXX
Instance Name: TESTNODE
Flavor: 1
Image: 13
SSH Keypair: KEY_PAIR_NAME

Waiting for server..................
Public IP Address: 8.21.28.154
Private IP Address: 8.21.28.154

Waiting for sshd..........done</pre>
		</div>
</div></div>
<p>It may pause at this step for a few minutes while SSHing into the instance. If it gets stuck at this step, make sure that you've properly set up the <a href="#OpenStackBootstrapFastStartGuide-ConfigureyourOpenStacksecuritygroup">security group</a>. You'll also want to confirm you've followed all of the steps to <a href="#OpenStackBootstrapFastStartGuide-CreateyourSSHkeypairforOpenStackandsaveyouride...">create and save your SSH Key</a>.</p>

<p>Once it has logged in it'll start running the bootstrap script and install the Chef-client:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">Waiting for sshd..........done
Bootstrapping Chef on 8.21.28.154
8.21.28.154 --2012-02-28 04:21:32--  http://opscode.com/chef/install.sh
8.21.28.154 Resolving opscode.com...
8.21.28.154 184.106.28.83
8.21.28.154 Connecting to opscode.com|184.106.28.83|:80...
8.21.28.154 connected.
8.21.28.154 HTTP request sent, awaiting response...
&lt;SNIP&gt;
8.21.28.154 Unpacking chef-full (from .../chef-full_0.10.8-2_amd64.deb) ...
8.21.28.154 Setting up chef-full (0.10.8-2) ...
8.21.28.154 Thank you for installing Chef!
8.21.28.154 Processing triggers for python-central ...</pre>
		</div>
</div></div>
<p>After a few minutes you should see it report that the Chef install was successful, and it'll run chef-client for the first time:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">8.21.28.154 [Tue, 28 Feb 2012 04:22:24 +0000] INFO: *** Chef 0.10.8 ***
8.21.28.154 [Tue, 28 Feb 2012 04:22:24 +0000] INFO: Client key /etc/chef/client.pem is not present - registering
8.21.28.154 [Tue, 28 Feb 2012 04:22:27 +0000] INFO: Setting the run_list to [] from JSON
8.21.28.154 [Tue, 28 Feb 2012 04:22:27 +0000] INFO: Run List is []
8.21.28.154 [Tue, 28 Feb 2012 04:22:27 +0000] INFO: Run List expands to []
8.21.28.154 [Tue, 28 Feb 2012 04:22:27 +0000] INFO: Starting Chef Run for TESTNODE
8.21.28.154 [Tue, 28 Feb 2012 04:22:27 +0000] INFO: Running start handlers
8.21.28.154 [Tue, 28 Feb 2012 04:22:27 +0000] INFO: Start handlers complete.
8.21.28.154 [Tue, 28 Feb 2012 04:22:28 +0000] INFO: Loading cookbooks []
8.21.28.154 [Tue, 28 Feb 2012 04:22:28 +0000] WARN: Node TESTNODE has an empty run list.
8.21.28.154 [Tue, 28 Feb 2012 04:22:28 +0000] INFO: Chef Run complete in 1.032248971 seconds
8.21.28.154 [Tue, 28 Feb 2012 04:22:28 +0000] INFO: Running report handlers
8.21.28.154 [Tue, 28 Feb 2012 04:22:28 +0000] INFO: Report handlers complete

Instance ID: XXX
Instance Name: TESTNODE
Flavor: 1
Image: 13
SSH Keypair: KEY_PAIR_NAME
Public IP Address: 8.21.28.154
Private IP Address: 8.21.28.154
Environment: _default</pre>
		</div>
</div></div>

<p>You should see the current version of Chef in the output of this command, Chef 10.12.0. Now chef-client has been installed on the OpenStack Instance and it is ready for recipes to be added to it. You can also add to the run_list when creating the instance by using the <tt>-r</tt> switch.</p>

<p>This process does not set up the Chef Client service as a daemon, you'll need to add a recipe in the run list that does this if needed. Step 7 also explains this further.</p>

<h2><a name="OpenStackBootstrapFastStartGuide-Step4%3AVerifytheinstallcompleted"></a>Step 4: Verify the install completed</h2>

<p>Now that the client has registered with Hosted Chef, it should show up on the openstack server list as well as the node list. You can use knife to display a list of openstack servers:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">% knife openstack server list
Instance ID     Name            Public IP       Private IP      Flavor          Image           Keypair         State
XXX             XXXXXX          8.21.28.154     8.21.28.154     1               13              KEY_PAIR_NAME   active</pre>
		</div>
</div></div>
<p>Instead of XXX you should see the instance id of your new node here. If it does not show up on this list, that means the OpenStack instance was not created.</p>

<p>You can also check that the client shows up on the node list with Hosted Chef:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">% knife node list
    NODENAME</pre>
		</div>
</div></div>
<p>Instead of NODENAME you should see the name of your new node here. If it does not show up on this list, that means it was unable to finish convergence and save the node at the end of the chef-client run. You can review your logs, or SSH into the node and try running <tt>sudo chef-client -l debug</tt> to get more information from the debug logs on why this failed.</p>

<h4><a name="OpenStackBootstrapFastStartGuide-TheClientinstallisnowcomplete"></a>The Client install is now complete</h4>

<p><font color="#f7681a">At this point, your instance has been created and is now configured as a client. </font>The next steps explain how to add a recipe and run it on this node remotely from the workstation, as well as run the client as a daemon. If you are already familiar with Chef, you can skip the rest of the guide and it will have no impact on your install.</p>

<p>If you need to set up another OpenStack instance, you can just repeat Step 3 as many times as needed. If you need to <a href="Launch Cloud Instances with Knife.html#LaunchCloudInstanceswithKnife-Deletingaserver">delete the instance</a> you've created, there are instructions on how to do this on the <a href="Launch Cloud Instances with Knife.html" title="Launch Cloud Instances with Knife">Launch Cloud Instances with Knife</a> page.</p>

<h2><a name="OpenStackBootstrapFastStartGuide-Step5%3AManagerecipesonthenewclientnode"></a>Step 5: Manage recipes on the new client node</h2>

<p>Now that your client is configured, you'll need to know how to add a recipe to it so you can start configuring it. This step will walk you through adding the getting-started recipe to it as an example. <font color="#f7681a">These steps are also ran from the management workstation.</font></p>

<p>We will need to download the getting-started cookbook from the Community Site:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">% cd ~/chef-repo
% knife cookbook site install getting-started
Installing getting-started to /home/username/chef-repo/.chef/../cookbooks
... output truncated ...
Cookbook getting-started version 0.3.0 successfully installed</pre>
		</div>
</div></div>

<p>And then upload the recipe to Hosted Chef so it is available for our nodes:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">% knife cookbook upload getting-started
Uploading getting-started          [0.3.0]
upload complete</pre>
		</div>
</div></div>

<p>Once this is completed, you can add this new recipe to the new nodes run list:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">% knife node run_list add NODENAME 'recipe[getting-started]'
run_list:  recipe[getting-started]</pre>
		</div>
</div></div>

<h2><a name="OpenStackBootstrapFastStartGuide-Step6%3ARunchefclientonthenewclientnode"></a>Step 6: Run chef-client on the new client node</h2>

<p><font color="#f7681a">You can just SSH into the node at this point and run <tt>sudo chef-client</tt>, but it may be easier to run this command remotely from the workstation with knife.</font> This way, once you have multiple nodes added you can run <tt>chef-client</tt> on all of them at once if needed by using a wildcard (&#42;) as the NODENAME.</p>

<p>You can run chef-client remotely from the management workstation with knife with the <a href="Knife Built In Subcommands.html#KnifeBuiltInSubcommands-SSH">SSH subcommand</a>:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife ssh name:NODENAME -x ubuntu "sudo chef-client"</pre>
		</div>
</div></div>
<p>By default, knife will use the internal FQDN to connect to nodes. When connecting from outside of your cloud you may need to force this to use the external FQDN. You will want to avoid doing this unless necessary, as this will route all traffic out through the NAT infrastructure and could cause performance hits or additional usage charges.</p>

<p>If you're sure you want to do this, you can do it with the -a option, such as in this example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife ssh name:NODENAME -x ubuntu "sudo chef-client" -a ipaddress</pre>
		</div>
</div></div>
<p>You do not want to edit the <tt>-a ipaddress</tt> portion when using this, as this is telling it to connect using the ipaddress attribute instead of the specific FQDN to connect to. For more information on the knife SSH subcommand, review the <a href="Knife Built In Subcommands.html#KnifeBuiltInSubcommands-SSH">Knife Built In Subcommands</a>.</p>

<p>Running <tt>chef-client</tt> will run the getting-started recipe you've added to the client node's run_list. The getting-started recipe added a template to the client node in ~/chef-getting-started.txt. Once Chef has completed on the client, you can log into the client and look at the template:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">% cat ~/chef-getting-started.txt
Welcome to Chef!

This is Chef version 0.10.x.
Running on ubuntu.
Version 10.04.</pre>
		</div>
</div></div>
<p>Your output will of course be dependent on the data we have stored about your node.</p>

<p>You can also see what code the recipe contained by opening it with a text editor from the Management Workstation:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">cd ~/chef-repo
vim cookbooks/getting-started/recipes/default.rb</pre>
		</div>
</div></div>
<p>For more information on editing and creating recipes, see the <a href="Cookbook Fast Start Guide.html" title="Cookbook Fast Start Guide">Cookbook Fast Start Guide</a>.</p>

<p>When you are ready to start configuring this node, you can remove this test recipe from the run_list with this command:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">% knife node run_list remove NODENAME 'recipe[getting-started]'
run_list:</pre>
		</div>
</div></div>

<h2><a name="OpenStackBootstrapFastStartGuide-Step7%3ARunningchefclientasadaemon"></a>Step 7: Running chef-client as a daemon</h2>

<p><font color="#f7681a">You can set up chef-client to run as a daemon, so it will periodically run chef-client and get any updates you have submitted without needing to SSH to it every time.</font> The easiest way to do this is with the chef-client cookbook. This will set up the chef-client as a daemon and add a time splay, you can add it the same way you added the getting-started recipe:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife cookbook site install chef-client
knife cookbook upload chef-client
knife node run_list add NODENAME 'recipe[chef-client]'</pre>
		</div>
</div></div>
<p>Once it is added you'll need to run chef-client on the node once more for the recipe to configure the server:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife ssh name:NODENAME -x ubuntu "sudo chef-client" -a ipaddress</pre>
		</div>
</div></div>
<p>Next time you bootstrap a new client node, you can include the <tt>chef-client</tt> cookbook in the <a href="Knife Bootstrap.html" title="Knife Bootstrap">Knife Bootstrap</a> command from Step 3 if desired. This will add it to the run_list for the node and run it when installing Chef. You can do this with the <tt>-r</tt> switch:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">knife openstack server create -S KEYPAIR -N TESTNODE -f 1 -I 3 -x ubuntu -r 'recipe[chef-client]'</pre>
		</div>
</div></div>
<p>You can read the cookbook's README to get more information on altering the default attributes.</p>

<p><br class="atl-forced-newline" /></p>
<div class="panel" style="border-color: #f7681a;border-width: 2px;"><div class="panelContent">
<h1><a name="OpenStackBootstrapFastStartGuide-Ifsomethinggoeswrong"></a>If something goes wrong</h1>
</div></div>
<p><font color="#f7681a">It only takes a small change to a dependency or environment to cause these instructions to not be exact.</font> If you need to <a href="Launch Cloud Instances with Knife.html#LaunchCloudInstanceswithKnife-Deletingaserver">delete the instance</a> you've created, there are instructions on how to do this on the <a href="Launch Cloud Instances with Knife.html" title="Launch Cloud Instances with Knife">Launch Cloud Instances with Knife</a> page.</p>

<p>If you want to troubleshoot the issue, first check the <a href="Installation.html" title="Installation">Installation</a> page and refer to documents specific to your OS. You may also want to try SSHing into the new instance and seeing if <tt>sudo chef-client -l debug</tt> gives you any additional debug information. If this doesn't help, head over to the <b><a href="Support.html" title="Support">Support</a></b> page for information on where and how to find help from Opscode and the rest of the Chef community.
<br class="atl-forced-newline" /></p>

<p><br class="atl-forced-newline" /></p>
<div class="panel" style="border-color: #f7681a;border-width: 2px;"><div class="panelContent">
<h1><a name="OpenStackBootstrapFastStartGuide-WhatshouldIlookatnext%3F"></a>What should I look at next?</h1>
</div></div>
<p><br class="atl-forced-newline" />
<font color="#f7681a"><b>More information on Knife Cloud Plugins...</b></font></p>
<h4><a name="OpenStackBootstrapFastStartGuide-LaunchCloudInstanceswithKnife"></a><a href="Launch Cloud Instances with Knife.html" title="Launch Cloud Instances with Knife">Launch Cloud Instances with Knife</a></h4>
<p>The Knife Cloud Plugins create an instance and then bootstrap it with chef-client. More information on the plugins available can be found on the <a href="Launch Cloud Instances with Knife.html" title="Launch Cloud Instances with Knife">Launch Cloud Instances with Knife</a> page.<br/>
<p><br class="atl-forced-newline" />
<font color="#f7681a"><b>Another fast start...</b></font></p>
<h4><a name="OpenStackBootstrapFastStartGuide-CookbookFastStartGuide"></a><a href="Cookbook Fast Start Guide.html" title="Cookbook Fast Start Guide">Cookbook Fast Start Guide</a></h4>
<p><a href="Cookbooks.html" title="Cookbooks">Cookbooks</a> are how things are distributed and shared in Chef. Continue on the fast start path and visit this page for a quick guide to writing and using Chef Cookbooks.</p>

<p><font color="#f7681a"><b>Perhaps detail on Chef and its use...</b></font></p>
<h4><a name="OpenStackBootstrapFastStartGuide-ChefBasics"></a><a href="Chef Basics.html" title="Chef Basics">Chef Basics</a></h4>
<p>Learn some of the central concepts of configuration management benefits for your infrastructure.  </p>
<ol>
	<li>We begin with an <a href="Architecture Introduction.html" title="Architecture Introduction">Architecture Introduction</a>, covering the basic functions of the Chef Server, Nodes, and Chef Workstations and how these components communicate.</li>
	<li>Then an overview of the <a href="Core Components.html" title="Core Components">Core Components</a>, which introduces all of the aspects and components of modeling your infrastructure, Configuring Nodes and Managing Chef.</li>
	<li>Onward to Cooking School and begin an <a href="Introduction to Cookbooks and More.html" title="Introduction to Cookbooks and More">Introduction to Cookbooks and More</a>. Cookbooks are Chef's fundamental units of distribution, the way Chef users package up, distribute and share configuration information. Recipes, Resources, Attributes, Roles and more are also introduced.</li>
	<li>The final basic section is an <a href="Introduction to Search and Data Bags.html" title="Introduction to Search and Data Bags">Introduction to Search and Data Bags</a>, two of Chef's most powerful features allowing you to dynamically change the configuration of your infrastructure based on data.</li>
</ol>


<h4><a name="OpenStackBootstrapFastStartGuide-ChefArchitectureArchitecture"></a><a href="Architecture.html" title="Architecture">Chef Architecture</a></h4>
<p>With all that under your belt, it's time to tackle the dirty secrets of what's happening behind the scenes with <a href="Architecture.html" title="Architecture">Chef Architecture</a>.  We'll give you the scoop on Chef's <a href="Authentication and Authorization.html" title="Authentication and Authorization">Authentication and Authorization</a> system and go over the <a href="Anatomy of a Chef Run.html" title="Anatomy of a Chef Run">Anatomy of a Chef Run</a>, where we go in-depth with the process by which your systems get configured. From there we'll review all the executable parts of Chef - <a href="Chef Client.html" title="Chef Client">Chef Client</a>, <a href="Chef Solo.html" title="Chef Solo">Chef Solo</a>, <a href="Chef Server.html" title="Chef Server">Chef Server</a>, <a href="Chef Indexer.html" title="Chef Indexer">Chef Indexer</a>, and <a href="Server API.html" title="Server API">Server API</a> and <a href="Cookbook Site API.html" title="Cookbook Site API">Cookbook Site API</a> interaction.</p>

<p><font color="#f7681a"><b>Or view video tutorials and training...</b></font></p>
<h4><a name="OpenStackBootstrapFastStartGuide-Guides"></a><a href="Guides.html" title="Guides">Guides</a></h4>
<p>We have a number of Walkthrough Guides available on the building of common stacks - including: <a href="Build A Rails Stack.html" title="Build A Rails Stack">Rails</a>, <a href="Build A Java Web Stack.html" title="Build A Java Web Stack">Java</a>, <a href="Build a LAMP Stack.html" title="Build a LAMP Stack">LAMP</a>, and more. There are also How To Guides such as <a href="Deploying OpenStack with Chef.html" title="Deploying OpenStack with Chef">Deploying OpenStack with Chef</a> and <a href="Guide to Creating A Cookbook and Writing A Recipe.html" title="Guide to Creating A Cookbook and Writing A Recipe">Guide to Creating A Cookbook and Writing A Recipe</a>. These should be good resources for you as you move forward in the automation of your infrastructure.</p>
<br class="atl-forced-newline" />
<br class="atl-forced-newline" />
<br class="atl-forced-newline" />
<br class="atl-forced-newline" /></p></td>
<td class="confluenceTd" valign="top" width="5%"></td></tr></tbody></table>
<table class="sectionMacro" border="0" cellpadding="5" cellspacing="0" width="100%"><tbody><tr>
<hr />
<td class="confluenceTd" valign="top" width="45%">

<p><span class="image-wrap" style="float: left"><img src="../attachments/24019295/24182865.png" hspace="4" style="border: 0px solid black"/></span><br/>
<a href="Installation.html" title="Installation">Installation</a></p>
</td>
<td class="confluenceTd" valign="top" width="40%"></td>

<td class="confluenceTd" valign="top" width="15%">

<p><span class="image-wrap" style="float: right"><img src="../attachments/24019295/24182864.png" hspace="4" style="border: 0px solid black"/></span><br/>
<a href="Cookbook Fast Start Guide.html" title="Cookbook Fast Start Guide">Cookbook Fast Start Guide</a></p>

<p><br class="atl-forced-newline" />
<br class="atl-forced-newline" /></p></td></tr></tbody></table>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">
                                <h2>Attachments:</h2>
                            </a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="../attachments/24019295/24182863.png">quickstart people.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="../attachments/24019295/24182864.png">rightarrow.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="../attachments/24019295/24182865.png">leftarrow.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="../attachments/24019295/24182866.jpg">Bootstrapping.jpg</a> (image/jpeg)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="../attachments/24019295/24182867.png">os-dashboard.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="../attachments/24019295/24182868.png">os-keypairs.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="../attachments/24019295/24182869.png">os-securitygroups.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="../attachments/24019295/24182870.png">openstack-cloud-software-vertical-small.png</a> (image/png)
                                <br/>
                                                    </div>
				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://wiki.opscode.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Aug 04, 2012 00:04</font></td>
		    </tr>
	    </table>
    </body>
</html>
